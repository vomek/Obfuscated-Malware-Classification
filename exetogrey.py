# -*- coding: utf-8 -*-
"""
Created on Thu Apr 30 16:02:57 2020

@author: Wamiq
source https://stackoverflow.com/questions/60193896/convert-file-into-grayscale-image
"""

import numpy as np
from math import sqrt, ceil
import cv2,os

def exetogrey(exename):
    #Input file name (random file I found in my folder)
    input_file_name = exename;
    #Read the whole file to data
    with open(input_file_name, 'rb') as binary_file:
        data = binary_file.read()

    # Data length in bytes
    data_len = len(data)
    
    # d is a verctor of data_len bytes
    d = np.frombuffer(data, dtype=np.uint8)
    
    # Assume image shape should be close to square
    sqrt_len = int(ceil(sqrt(data_len)))  # Compute square toot and round up
    
    # Requiered length in bytes.
    new_len = sqrt_len*sqrt_len
    
    # Number of bytes to pad (need to add zeros to the end of d)
    pad_len = new_len - data_len
    
    # Pad d with zeros at the end.
    # padded_d = np.pad(d, (0, pad_len))
    padded_d = np.hstack((d, np.zeros(pad_len, np.uint8)))
    
    # Reshape 1D array into 2D array with sqrt_len pad_len x sqrt_len (im is going to be a Grayscale image).
    im = np.reshape(padded_d, (sqrt_len, sqrt_len))
    
    # Save image
    cv2.imwrite(exename+'.png', im)
    
    # Display image
    #cv2.imshow('im' ,im)
    #cv2.waitKey(0)
    cv2.destroyAllWindows()

os.chdir("D:\\VirusPEFiles\\Files\\runonce")
list_fams = os.listdir(os.getcwd())
NameList =[]
#import csv

"""
with open('D:\\Pyfiles\\trainLabels.csv') as csv_file:
    csv_reader = csv.reader(csv_file, delimiter=',')
    line_count = 0
    for row in csv_reader:
        NameList.append(row[0])
        line_count+=1  
        if(line_count==1013):
            break
    print(f'Processed {line_count} lines.') 
"""

for filename in list_fams:
    #newfilename = filename.replace(".asm","")
    #if(filename == "kDj1KVgGfTIFWPX9idoc"):
    if filename=="104"  or filename=="127" or filename=="129"  or filename=="158"  or filename=="159" or filename=="167" or filename=="185" or filename=="195" or filename=="206" or filename=="214" or filename=="228" or filename=="254"  or filename=="280"  or filename=="281" or filename=="322"  or filename=="323"   :
        print(filename)
    else:
        exetogrey(filename)


